(self.webpackChunkflappybird=self.webpackChunkflappybird||[]).push([[57],{491:function(t){(function(){var e,i,s,n,a,o;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(t.exports=function(){return(e()-a)/1e6},i=process.hrtime,n=(e=function(){var t;return 1e9*(t=i())[0]+t[1]})(),o=1e9*process.uptime(),a=n-o):Date.now?(t.exports=function(){return Date.now()-s},s=Date.now()):(t.exports=function(){return(new Date).getTime()-s},s=(new Date).getTime())}).call(this)},146:(t,e,i)=>{for(var s=i(491),n="undefined"==typeof window?i.g:window,a=["moz","webkit"],o="AnimationFrame",h=n["request"+o],r=n["cancel"+o]||n["cancelRequest"+o],c=0;!h&&c<a.length;c++)h=n[a[c]+"Request"+o],r=n[a[c]+"Cancel"+o]||n[a[c]+"CancelRequest"+o];if(!h||!r){var l=0,d=0,u=[],g=1e3/60;h=function(t){if(0===u.length){var e=s(),i=Math.max(0,g-(e-l));l=i+e,setTimeout((function(){var t=u.slice(0);u.length=0;for(var e=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(l)}catch(t){setTimeout((function(){throw t}),0)}}),Math.round(i))}return u.push({handle:++d,callback:t,cancelled:!1}),d},r=function(t){for(var e=0;e<u.length;e++)u[e].handle===t&&(u[e].cancelled=!0)}}t.exports=function(t){return h.call(n,t)},t.exports.cancel=function(){r.apply(n,arguments)},t.exports.polyfill=function(t){t||(t=n),t.requestAnimationFrame=h,t.cancelAnimationFrame=r}},794:(t,e,i)=>{"use strict";var s={};i.r(s),i.d(s,{cubicBezier:()=>F,easeOut:()=>G,easeOutCirc:()=>U,easeOutExpo:()=>N,linear:()=>L,quadratic:()=>R,sineWaveHS:()=>H,swing:()=>M});const n=i.p+"1f82ae5350be3039bfb3.png";class a{fps;timeArray;context;containerOpacity;textProps;containerProps;static SHOW_FPS=!1;constructor(t){this.fps=0,this.timeArray=[],this.context=t,this.containerOpacity=.4,this.textProps={position:{x:0,y:0},preText:"",postText:""},this.containerProps={startingPoint:{x:0,y:0},endPoint:{x:0,y:0}}}text(t,e,i){this.textProps.position=t,this.textProps.preText=e,this.textProps.postText=i}container(t,e){this.containerProps={startingPoint:t,endPoint:e}}mark(){const t=performance.now();for(;this.timeArray.length>0&&this.timeArray[0]<=t-1e3;)this.timeArray.shift();this.timeArray.push(t),this.fps=this.timeArray.length,this.drawContainer(),this.drawText(String(this.fps))}drawContainer(){const t=this.context,{startingPoint:e,endPoint:i}=this.containerProps;t.beginPath(),t.globalAlpha=this.containerOpacity,t.fillStyle="#1e1e20",t.fillRect(e.x,e.y,i.x,i.y),t.fill(),t.closePath()}drawText(t){const e=this.context,{preText:i,postText:s,position:n}=this.textProps,a=`${i}${t}${s}`;e.beginPath(),e.globalAlpha=1,e.font="30px monospace",e.fillStyle="#58d130",e.textAlign="left",e.fillText(a,n.x,n.y),e.closePath()}PROD_SHOW_FPS(){a.SHOW_FPS&&this.mark()}}const o=(t,e)=>{const i={width:0,height:0};return"width"in e?(i.width=e.width,i.height=t.height/t.width*e.width):"height"in e&&(i.height=e.height,i.width=t.width*e.height/t.height),i},h=.32,r={width:288,height:512},c={width:34,height:24},l={width:100,height:300},d={width:24,height:36};class u{static audioContext;static Cached={};static concurrentDownload=5;static gainContext;static isReady=!1;constructor(t,e){u.audioContext=new(AudioContext||webkitAudioContext),u.audioContext.addEventListener("statechange",(()=>{u.isReady="running"===u.audioContext.state})),u.load(t,e)}static play(t,e){if(void 0===typeof u.Cached[t])throw new TypeError(`Key ${t} does not load or not exists.`);if(void 0!==u.gainContext){if(u.isReady)try{const i=u.audioContext.createBufferSource();i.buffer=u.Cached[t],i.addEventListener("ended",(()=>e?.())),i.connect(u.gainContext),i.start()}catch(e){throw new Error(`Failed to play audio: ${t}. Error: ${e}`)}}else console.warn("WebSfx.play cannot execute. AudioContext is not started or resumed")}static volume(t){if(void 0!==u.gainContext)try{u.gainContext.gain.value=t}catch(t){}else console.warn("WebSfx.volume cannot set volume. AudioContext is not started or resumed")}static async init(){if(u.isReady&&void 0!==u.gainContext)return;await u.audioContext.resume();const t=u.audioContext.createGain();t.connect(u.audioContext.destination),u.gainContext=t}static load(t,e,i=0){const s=[],n=Object.entries(t);for(let t=i*u.concurrentDownload;t<Math.min(n.length,u.concurrentDownload);t++){if(!/\.(wav|ogg|mp3)$/i.test(n[t][1]))throw new TypeError("WebSfx.contructor accepts 'wav|ogg|mp3' type of files");s.push(u.load_requests(n[t][0],n[t][1]))}Promise.allSettled(s).then((s=>{s.forEach((t=>{"fulfilled"===t.status&&(u.Cached[t.value.name]=t.value.content,u.Cached[t.value.path]=u.Cached[t.value.name])})),n.length>(i+1)*u.concurrentDownload?u.load(t,e,i+1):e(u.Cached)}))}static load_requests(t,e){return new Promise((async(i,s)=>{try{const s=await fetch(e,{method:"GET",mode:"no-cors"});if(!s.ok)throw new TypeError(`Erro while fetching '${e}`);const n=await s.arrayBuffer();i({content:await u.audioContext.decodeAudioData(n),path:e,name:t})}catch(t){s()}}))}}class g{canvasSize;velocity;coordinate;constructor(){this.canvasSize={width:0,height:0},this.velocity={x:0,y:0},this.coordinate={x:0,y:0}}resize({width:t,height:e}){this.canvasSize={width:t,height:e}}}class p{sprite;Canvas=document.createElement("canvas");ctx;static cached=new Map;loading;then_called;constructor(t){this.sprite=t,this.ctx=this.Canvas.getContext("2d"),this.loading=[],this.then_called=!1}async then(t){this.then_called||(this.then_called=!0,await Promise.allSettled(this.loading).then((e=>{let i=0;for(const t of e)"fulfilled"===t.status&&"value"in t?p.cached.set(t.value.name,t.value.img):++i;console.log(`Error count: ${i}`),t()})))}static asset(t){if(p.cached.has(t))return p.cached.get(t);throw new TypeError(`Key: ${t} does not defined on SpriteDestructor`)}cutOut(t,e,i,s,n){this.Canvas.width=s,this.Canvas.height=n,this.ctx.clearRect(0,0,s,n),this.ctx.imageSmoothingEnabled=!1,this.ctx.drawImage(this.sprite,e,i,s,n,0,0,s,n),this.feedImage(t)}feedImage(t){this.loading.push(new Promise(((e,i)=>{const s=new Image;s.src=this.Canvas.toDataURL(),s.addEventListener("load",(()=>e({name:t,img:s}))),s.addEventListener("error",(t=>i(t)))})))}}const m=(t,e)=>Math.floor(Math.random()*(e-t))+t;class f{static birdColorList=[];static bgThemeList=[];static pipeColorList=[];static isNight=!1;static get background(){if(f.bgThemeList.length<1)throw new Error("No theme available");const t=f.bgThemeList[m(0,f.bgThemeList.length)];return f.isNight="night"===t,t}static get bird(){if(f.birdColorList.length<1)throw new Error("No available bird color");return f.birdColorList[m(0,f.birdColorList.length)]}static get pipe(){if(f.pipeColorList.length<1)throw new Error("No available pipe color");return f.isNight?f.pipeColorList[m(0,f.pipeColorList.length)]:"green"}}class v extends g{backgroundSize;images;theme;constructor(){super(),this.images=new Map,this.theme="day",this.velocity.x=.0256,this.backgroundSize={width:0,height:0}}init(){this.images.set("day",p.asset("theme-day")),this.images.set("night",p.asset("theme-night")),Object.assign(f.bgThemeList,["day","night"]),this.use(f.background)}reset(){this.coordinate={x:0,y:0},this.resize(this.canvasSize),this.use(f.background)}use(t){this.theme=t}resize({width:t,height:e}){super.resize({width:t,height:e}),this.backgroundSize=o({width:this.images.get(this.theme).width,height:this.images.get(this.theme).height},{height:e})}Update(t){this.coordinate.x+=this.canvasSize.width*this.velocity.x*t,this.coordinate.y+=this.velocity.y}Display(t){const{width:e,height:i}=this.backgroundSize,{x:s,y:n}=this.coordinate,a=Math.ceil(this.canvasSize.width/e)+1,o=s%e;for(let s=0;s<a;s++)t.drawImage(this.images.get(this.theme),s*(e-s)-o,n,e,i)}}const w=(t,e)=>{const i=(new Date).getTime();return Math.sin(i/1e3*2*Math.PI/(1/t))*e},y=(t,e,i)=>Math.max(Math.min(i,e),t),b=(t,e,i)=>e-(i-t);var S,x;!function(t){t.normal="normal",t.trollMove="trollMove",t.fakeGap="fakeGap",t.snapClose="snapClose",t.reverseZone="reverseZone"}(S||(S={})),function(t){t.doubleTroll="doubleTroll",t.gapTeleport="gapTeleport",t.gapDrift="gapDrift",t.pipeSwap="pipeSwap",t.fakeCeiling="fakeCeiling",t.phantomPipe="phantomPipe",t.lateSpawn="lateSpawn",t.collisionShift="collisionShift",t.invisiblePipe="invisiblePipe",t.magnetPipe="magnetPipe",t.shrinkingPipe="shrinkingPipe",t.baitPipe="baitPipe",t.flapRandom="flapRandom",t.flapDelay="flapDelay",t.suddenDrop="suddenDrop",t.airBurst="airBurst",t.inputLag="inputLag",t.gravityShift="gravityShift",t.windGust="windGust"}(x||(x={}));const C=[x.doubleTroll,x.gapTeleport,x.gapDrift,x.pipeSwap,x.fakeCeiling,x.phantomPipe,x.lateSpawn,x.collisionShift,x.invisiblePipe,x.magnetPipe,x.shrinkingPipe,x.baitPipe],A=[x.flapRandom,x.flapDelay,x.suddenDrop,x.airBurst,x.inputLag,x.gravityShift,x.windGust];function I(t){return t%2==0?1:-1}class O extends g{static pipeSize={width:0,height:0};scaled;hollSize;pipePosition;isPassed;pipeIndex;images;color;type;triggered;chaosEvents;originalY;originalHollSize;shiftCount;driftOffset;driftDirection;snapCloseProgress;hasTeleported;teleportTargetY;collisionOffsetX;collisionOffsetY;phantomPipeOffset;isLateSpawn;spawnDelay;fakeCeilingY;shrinkingStarted;originalPipeWidth;currentBirdX;static TROLL_SHIFT_DISTANCE=90;static SNAP_CLOSE_DURATION=.08;static SNAP_CLOSE_MIN_GAP=5;static TELEPORT_DISTANCE=120;static DRIFT_SPEED=70;static MAX_SHIFTS=3;constructor(t=0){super(),this.images=new Map,this.color="green",this.hollSize=0,this.pipePosition={top:{x:0,y:0},bottom:{x:0,y:0}},this.isPassed=!1,this.velocity.x=h,this.scaled={top:{width:0,height:0},bottom:{width:0,height:0}},this.pipeIndex=t,this.type=S.normal,this.triggered=!1,this.chaosEvents=[],this.originalY=0,this.originalHollSize=0,this.shiftCount=0,this.driftOffset=0,this.driftDirection=1,this.snapCloseProgress=0,this.hasTeleported=!1,this.teleportTargetY=0,this.collisionOffsetX=0,this.collisionOffsetY=0,this.phantomPipeOffset=0,this.isLateSpawn=!1,this.spawnDelay=0,this.fakeCeilingY=0,this.shrinkingStarted=!1,this.originalPipeWidth=0,this.currentBirdX=0}init(){this.images.set("green.top",p.asset("pipe-green-top")),this.images.set("green.bottom",p.asset("pipe-green-bottom")),this.images.set("red.top",p.asset("pipe-red-top")),this.images.set("red.bottom",p.asset("pipe-red-bottom")),Object.assign(f.pipeColorList,["red","green"])}assignTrapTypeAndChaos(){this.type=function(t){if(t<3)return S.normal;const e=Math.random();return e<.25?S.reverseZone:e<.5?S.snapClose:e<.75?S.fakeGap:e<.9?S.trollMove:S.normal}(this.pipeIndex)}setHollPosition(t){this.hollSize=.184*this.canvasSize.height,this.originalHollSize=this.hollSize,this.coordinate=t,this.originalY=t.y,this.teleportTargetY=t.y}setChaosEvents(t){this.chaosEvents=t,this.chaosEvents.includes(x.gapDrift)&&(this.driftDirection=Math.random()>.5?1:-1),this.chaosEvents.includes(x.collisionShift)&&(this.collisionOffsetX=30*(Math.random()-.5),this.collisionOffsetY=40*(Math.random()-.5)),this.chaosEvents.includes(x.phantomPipe)&&(this.phantomPipeOffset=(Math.random()>.5?1:-1)*(30+40*Math.random())),this.chaosEvents.includes(x.fakeCeiling)&&(this.fakeCeilingY=this.originalY-.3*this.hollSize),this.chaosEvents.includes(x.lateSpawn)&&(this.isLateSpawn=!0,this.spawnDelay=.05+.1*Math.random())}isInLateTriggerZone(t){const e=O.pipeSize.width/2,i=this.coordinate.x-e;return t>=i-100&&t<i}executeTrollMove(){if(this.shiftCount>=O.MAX_SHIFTS&&this.chaosEvents.includes(x.doubleTroll))return;if(this.shiftCount>=1&&!this.chaosEvents.includes(x.doubleTroll))return;const t=I(this.pipeIndex+this.shiftCount),e=O.TROLL_SHIFT_DISTANCE*t*(this.shiftCount%2==0?1:-1);this.coordinate.y+=e,this.shiftCount++,this.chaosEvents.includes(x.doubleTroll)&&1===this.shiftCount&&setTimeout((()=>{this.isPassed||this.executeTrollMove()}),150)}executeGapTeleport(){if(this.hasTeleported)return;const t=(Math.random()-.5)*O.TELEPORT_DISTANCE*2;this.teleportTargetY=this.originalY+t,this.coordinate.y=this.teleportTargetY,this.hasTeleported=!0}updateGapDrift(t){this.isInLateTriggerZone(this.currentBirdX)&&(this.driftOffset+=this.driftDirection*O.DRIFT_SPEED*t,Math.abs(this.driftOffset)>50&&(this.driftDirection*=-1),this.coordinate.y=this.originalY+this.driftOffset)}executeSnapClose(t){if(this.snapCloseProgress>=1)return;this.snapCloseProgress+=t/O.SNAP_CLOSE_DURATION,this.snapCloseProgress=Math.min(this.snapCloseProgress,1);const e=O.SNAP_CLOSE_MIN_GAP;this.hollSize=this.originalHollSize-(this.originalHollSize-e)*this.snapCloseProgress,this.snapCloseProgress>=1&&(this.triggered=!0)}isInReverseZone(t,e,i){if(this.type!==S.reverseZone)return!1;const s=O.pipeSize.width/2,n=this.coordinate.x+this.collisionOffsetX,a=this.hollSize/2,o=Math.abs(n-s)<=t+i&&n+s>=t-i,h=e>=this.coordinate.y+this.collisionOffsetY-a&&e<=this.coordinate.y+this.collisionOffsetY+a;return o&&h}hasCollision(){return!this.chaosEvents.includes(x.baitPipe)}getEffectiveGapBounds(){const t=this.hollSize/2,e=this.coordinate.y+this.collisionOffsetY;return this.type===S.fakeGap?{top:e,bottom:e,isSolid:!0,hasCeiling:!1,ceilingY:0}:{top:e-t,bottom:e+t,isSolid:!1,hasCeiling:this.chaosEvents.includes(x.fakeCeiling),ceilingY:this.fakeCeilingY}}getPhantomBounds(){return this.chaosEvents.includes(x.phantomPipe)?{x:this.coordinate.x+this.phantomPipeOffset,top:this.coordinate.y-.5*this.hollSize,bottom:this.coordinate.y+.5*this.hollSize}:null}resetAfterPass(){this.type===S.snapClose&&(this.hollSize=this.originalHollSize,this.snapCloseProgress=0,this.triggered=!1)}checkPhantomCollision(t,e,i,s){const n=this.getPhantomBounds();if(!n)return!1;const a=O.pipeSize.width/2,o=Math.abs(n.x-a)<=t+i&&n.x+a>=t-i,h=e-s<n.top||e+s>n.bottom;return o&&h}resize({width:t,height:e}){const i=this.coordinate.x/this.canvasSize.width*100,s=this.originalY/this.canvasSize.height*100;super.resize({width:t,height:e});const n=.18*this.canvasSize.width;O.pipeSize=o(l,{width:n}),this.hollSize=.184*this.canvasSize.height,this.originalHollSize=this.hollSize,this.coordinate.x=t*(i/100),this.originalY=e*(s/100),0===this.shiftCount&&(this.coordinate.y=this.originalY),this.velocity.x=t*h,this.scaled.top=o({width:this.images.get(`${this.color}.top`).width,height:this.images.get(`${this.color}.top`).height},{width:n}),this.scaled.bottom=o({width:this.images.get(`${this.color}.bottom`).width,height:this.images.get(`${this.color}.bottom`).height},{width:n})}isOut(){return this.coordinate.x+O.pipeSize.width<0}use(t){this.color=t}Update(t){this.isLateSpawn&&this.spawnDelay>0?this.spawnDelay-=t:(this.coordinate.x-=this.velocity.x*t,this.isInLateTriggerZone(this.currentBirdX)&&(this.type!==S.trollMove&&!this.chaosEvents.includes(x.doubleTroll)||0!==this.shiftCount||this.executeTrollMove(),this.chaosEvents.includes(x.gapTeleport)&&!this.hasTeleported&&this.executeGapTeleport(),this.type===S.snapClose&&this.executeSnapClose(t)),this.chaosEvents.includes(x.gapDrift)&&this.updateGapDrift(t),this.chaosEvents.includes(x.shrinkingPipe)&&(this.isInLateTriggerZone(this.currentBirdX)&&!this.shrinkingStarted&&(this.shrinkingStarted=!0,this.originalPipeWidth=O.pipeSize.width),this.shrinkingStarted&&O.pipeSize.width>.4*this.originalPipeWidth&&(O.pipeSize.width*=.98)),this.chaosEvents.includes(x.magnetPipe))}Display(t){if(this.isLateSpawn&&this.spawnDelay>0)return;if(this.chaosEvents.includes(x.invisiblePipe)){if(Math.abs(this.coordinate.x-this.currentBirdX)>60)return;t.globalAlpha=.15}const e=O.pipeSize.width/2,i=this.coordinate.x,s=this.coordinate.y,n=this.hollSize/2;this.drawChaosHints(t,i,s,n,e),t.save(),this.chaosEvents.length>0&&Math.random()>.95&&(t.globalAlpha=.9),t.drawImage(this.images.get(`${this.color}.top`),i-e,-(this.scaled.top.height-Math.abs(s-n)),this.scaled.top.width,this.scaled.top.height),t.drawImage(this.images.get(`${this.color}.bottom`),i-e,s+n,this.scaled.bottom.width,this.scaled.bottom.height),t.restore()}drawChaosHints(t,e,i,s,n){switch(this.type){case S.trollMove:t.save(),t.fillStyle="rgba(100, 100, 100, 0.4)",t.font="10px Arial",t.textAlign="center",t.textBaseline="middle";const a=I(this.pipeIndex);t.fillText(a>0?"▼":"▲",e,i),t.restore();break;case S.fakeGap:t.save(),t.fillStyle="rgba(0, 0, 0, 0.15)",t.fillRect(e-.3*n,i-.8*s,.6*n,1.6*s),t.restore();break;case S.snapClose:t.save(),t.strokeStyle="rgba(200, 50, 50, 0.3)",t.lineWidth=1,t.beginPath(),t.moveTo(e-.2*n,i-.5*s),t.lineTo(e+.2*n,i-.5*s),t.moveTo(e-.2*n,i+.5*s),t.lineTo(e+.2*n,i+.5*s),t.stroke(),t.restore();break;case S.reverseZone:t.save(),t.strokeStyle="rgba(100, 50, 150, 0.2)",t.lineWidth=1,t.beginPath(),t.arc(e,i,.3*s,0,2*Math.PI),t.stroke(),t.restore()}this.chaosEvents.length>0&&(t.save(),t.fillStyle="rgba(255, 0, 0, 0.15)",t.fillRect(e-2,i-s,4,2*s),t.restore())}}const k=i.p+"fb85655698a54f8cde03153d61436a8e.ogg",E=i.p+"53be63225a77062f0e0567615aaef471.ogg",z=i.p+"25b7658563967e60ca23fb51af9c084f.ogg",D=i.p+"09f7e99dce7a2d12b43909f45bcff6f2.ogg",T=i.p+"06f58df2486e5ade890cf491a58b4e35.ogg";class P{static currentVolume=1;static async init(){await u.init()}static volume(t){P.currentVolume=t}static die(){u.volume(P.currentVolume),u.play(k)}static point(){u.volume(P.currentVolume),u.play(z)}static hit(t){u.volume(P.currentVolume),u.play(E,t)}static swoosh(){u.volume(P.currentVolume),u.play(D)}static wing(){u.volume(P.currentVolume),u.play(T)}}class _ extends g{static FLAG_IS_ALIVE=1;static FLAG_DIED=2;static FLAG_DOES_LANDED=4;flags;static platformHeight=0;score;wingState;scaled;rotation;force;causeOfDeath;images;color;lastCoord;isInReverseZone;activeChaosEvents;pendingFlap;flapDelayTimer;airBurstActive;airBurstTimer;suddenDropCooldown;gravityMultiplier;windForce;windTimer;onPipePassed;constructor(){super(),this.color="yellow",this.images=new Map,this.force=0,this.scaled={width:0,height:0},this.score=0,this.rotation=0,this.causeOfDeath=0,this.flags=1,this.lastCoord=0,this.wingState=1,this.isInReverseZone=!1,this.activeChaosEvents=[],this.pendingFlap=!1,this.flapDelayTimer=0,this.airBurstActive=!1,this.airBurstTimer=0,this.suddenDropCooldown=0,this.gravityMultiplier=1,this.windForce=0,this.windTimer=0,this.onPipePassed=null}init(){this.images.set("yellow.0",p.asset("bird-yellow-up")),this.images.set("yellow.1",p.asset("bird-yellow-mid")),this.images.set("yellow.2",p.asset("bird-yellow-down")),this.images.set("blue.0",p.asset("bird-blue-up")),this.images.set("blue.1",p.asset("bird-blue-mid")),this.images.set("blue.2",p.asset("bird-blue-down")),this.images.set("red.0",p.asset("bird-red-up")),this.images.set("red.1",p.asset("bird-red-mid")),this.images.set("red.2",p.asset("bird-red-down")),Object.assign(f.birdColorList,["yellow","red","blue"]),this.use(f.bird)}variableReset(){this.score=0,this.rotation=0,this.causeOfDeath=0,this.flags=1,this.lastCoord=0,this.wingState=1,this.isInReverseZone=!1,this.activeChaosEvents=[],this.pendingFlap=!1,this.flapDelayTimer=0,this.airBurstActive=!1,this.airBurstTimer=0,this.suddenDropCooldown=0,this.gravityMultiplier=1,this.windForce=0,this.windTimer=0}reset(){this.variableReset(),this.resize(this.canvasSize),this.use(f.bird)}get alive(){return!!(this.flags&_.FLAG_IS_ALIVE)}resize({width:t,height:e}){super.resize({width:t,height:e}),this.coordinate.y=.5*_.platformHeight,this.coordinate.x=.3*t,this.force=-.5533*e,this.scaled=o(c,{height:.024*e})}triggerChaosEvents(){this.activeChaosEvents=function(){const t=[];if(Math.random()<.2){const e=A[Math.floor(Math.random()*A.length)];t.push(e)}return t}()}flap(){if(!(this.coordinate.y<0)&&this.flags&_.FLAG_IS_ALIVE&&!(this.activeChaosEvents.includes(x.inputLag)&&Math.random()<.05))return this.activeChaosEvents.includes(x.flapDelay)&&!this.pendingFlap?(this.pendingFlap=!0,void(this.flapDelayTimer=.05+.07*Math.random())):void this.executeFlap()}executeFlap(){P.wing();let t=this.force;this.activeChaosEvents.includes(x.flapRandom)&&(t*=.7+.6*Math.random()),this.airBurstActive&&(t*=.6),this.isInReverseZone?this.velocity.y=-t:this.velocity.y=t,this.lastCoord=this.coordinate.y,this.pendingFlap=!1,this.flapDelayTimer=0}setReverseZone(t){this.isInReverseZone=t}doesHitTheFloor(){return this.coordinate.y+this.rotatedDimension().height>Math.abs(this.canvasSize.height-_.platformHeight)}isDead(t){if(this.doesHitTheFloor())return this.flags&=~_.FLAG_IS_ALIVE,this.causeOfDeath=1,!(this.flags&_.FLAG_IS_ALIVE);const e=this.rotatedDimension(),i=e.width-e.height/2;for(const s of t)try{if(!s.hasCollision())continue;const t=s.coordinate.x,n=O.pipeSize.width/2;if(t+n<this.coordinate.x-i)continue;if(Math.abs(t-n)<=this.coordinate.x+i){t<this.coordinate.x&&!s.isPassed&&(this.score++,P.point(),s.isPassed=!0,this.triggerChaosEvents(),this.onPipePassed&&this.onPipePassed());const i=s.getEffectiveGapBounds();if(i.isSolid||this.coordinate.y-e.height<i.top||this.coordinate.y+e.height>i.bottom){this.flags&=~_.FLAG_IS_ALIVE,this.causeOfDeath=2;break}if(i.hasCeiling&&this.coordinate.y-e.height<i.ceilingY){this.flags&=~_.FLAG_IS_ALIVE,this.causeOfDeath=2;break}}if(s.checkPhantomCollision(this.coordinate.x,this.coordinate.y,i,e.height)){this.flags&=~_.FLAG_IS_ALIVE,this.causeOfDeath=2;break}break}catch(t){}return!(this.flags&_.FLAG_IS_ALIVE)}rotatedDimension(){const t=this.rotation*Math.PI/180,e=this.scaled.width/2,i=this.scaled.height/2,s=Math.sin(t),n=Math.cos(t);return{width:2*Math.sqrt(Math.pow(e*n,2)+Math.pow(i*s,2)),height:2*Math.sqrt(Math.pow(e*s,2)+Math.pow(i*n,2))}}playDead(){this.flags&_.FLAG_DIED||(this.flags|=_.FLAG_DIED,2===this.causeOfDeath&&P.die())}use(t){this.color=t}doWave({x:t,y:e},i,s){this.flapWing(3),e+=w(i,s),this.coordinate={x:t,y:e}}flapWing(t){this.wingState=1+w(t,2)|0,this.rotation>70&&(this.wingState=1)}handleRotation(t){if(this.rotation+=(this.coordinate.y<this.lastCoord?-7.2:6.5)*t*48,this.rotation=y(-19,90,this.rotation),!(this.flags&_.FLAG_IS_ALIVE))return void(this.wingState=1);const e=Math.abs(-19),i=4+(this.rotation+e)/(e+90)*3.2;this.flapWing(b(4,8.2,i))}Update(t){if(this.doesHitTheFloor()||this.flags&_.FLAG_DOES_LANDED)return this.flags|=_.FLAG_DOES_LANDED,this.coordinate.y=this.canvasSize.height-_.platformHeight-this.rotatedDimension().height,void this.handleRotation(t);this.pendingFlap&&this.flapDelayTimer>0&&(this.flapDelayTimer-=t,this.flapDelayTimer<=0&&this.executeFlap()),this.suddenDropCooldown>0&&(this.suddenDropCooldown-=t),this.activeChaosEvents.includes(x.suddenDrop)&&this.suddenDropCooldown<=0&&Math.random()<.005&&(this.velocity.y+=.3*this.canvasSize.height,this.suddenDropCooldown=2),this.activeChaosEvents.includes(x.airBurst)&&(!this.airBurstActive&&Math.random()<.1&&(this.airBurstActive=!0,this.airBurstTimer=5),this.airBurstActive&&(this.airBurstTimer-=t,this.airBurstTimer<=0&&(this.airBurstActive=!1))),this.activeChaosEvents.includes(x.gravityShift)?Math.random()<.02&&(this.gravityMultiplier=.8+.4*Math.random()):this.gravityMultiplier=1,this.activeChaosEvents.includes(x.windGust)&&(this.windTimer<=0&&Math.random()<.01&&(this.windForce=50*(Math.random()-.5),this.windTimer=1+1.5*Math.random()),this.windTimer>0&&(this.windTimer-=t,this.coordinate.x+=this.windForce*t,this.coordinate.x=y(this.scaled.width,this.canvasSize.width-this.scaled.width,this.coordinate.x)));let e=1.658*this.canvasSize.height*this.gravityMultiplier;this.airBurstActive&&(e*=1.5),this.velocity.y+=e*t,this.velocity.y=Math.min(this.velocity.y,.793*this.canvasSize.height),this.velocity.y=y(.8*-this.canvasSize.height,.793*this.canvasSize.height,this.velocity.y),this.coordinate.y+=this.velocity.y*t,this.handleRotation(t)}Display(t){const e=`${this.color}.${this.wingState}`;t.save(),t.translate(this.coordinate.x,this.coordinate.y),t.rotate(this.rotation*Math.PI/180),this.activeChaosEvents.length>0&&Math.random()>.95&&(t.globalAlpha=.8,t.translate(4*(Math.random()-.5),4*(Math.random()-.5))),t.drawImage(this.images.get(e),-this.scaled.width,-this.scaled.height,2*this.scaled.width,2*this.scaled.height),t.restore()}}class B{isRunning;isComplete;startTime;constructor(){this.isComplete=!1,this.isRunning=!1,this.startTime=0}get time(){return performance.now()}get timeDiff(){return this.isRunning?this.time-this.startTime:0}stop(){this.isComplete=!0,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.isComplete=!1,this.startTime=this.time)}reset(){this.isComplete=!1,this.isRunning=!1}}const M=t=>.5-Math.cos(t*Math.PI)/2,L=t=>t,R=t=>Math.pow(t,2),F=t=>t<=.5?2*Math.pow(t,3):1-2*Math.pow(t,3),G=t=>.5-Math.cos(t*Math.PI)/2,H=t=>Math.sin(2*t*Math.PI/2),U=t=>Math.sqrt(1-Math.pow(t-1,2)),N=t=>1===t?1:1-Math.pow(2,-10*t);class W extends B{options;constructor(t){super(),this.options={duration:500,transition:"swing"},Object.assign(this.options,t??{})}get status(){return{running:this.isRunning,complete:this.isComplete}}inUseTransition(t){return s[this.options.transition](t)}}class V extends W{get value(){if(this.isComplete||!this.isRunning)return 0;const t=this.timeDiff/this.options.duration;return t>=1?(this.stop(),0):this.inUseTransition(b(0,1,t))}}class $ extends B{options;constructor(t){super(),this.options={duration:500,from:{x:0,y:0},to:{x:0,y:0},transition:"cubicBezier"},Object.assign(this.options,t)}get status(){return{running:this.isRunning,complete:this.isComplete}}inUseTransition(t){return s[this.options.transition](t)}}const Y=(t,e,i)=>t+(e-t)*i;class j extends ${get value(){if(!this.isRunning)return this.isComplete?this.options.to:this.options.from;const t=this.options.from,e=this.options.to,i=this.timeDiff/this.options.duration;return i>=1?(this.stop(),this.options.to):{x:Y(t.x,e.x,this.inUseTransition(i)),y:Y(t.y,e.y,this.inUseTransition(i))}}}class X extends B{options;constructor(t){super(),this.options={durations:{fading:400,bounce:1e3}},Object.assign(this.options,t)}get status(){return{running:this.isRunning,complete:this.isComplete}}get value(){if(!this.isRunning)return{opacity:this.isComplete?1:0,value:0};const{fading:t,bounce:e}=this.options.durations,i=this.timeDiff;let s=M(i/t),n=-H(i/e);return i>=Math.max(t,e)?(this.stop(),{opacity:1,value:0}):(i>=t&&(s=1),i>=e&&(n=0),{opacity:s,value:n})}}class Z extends B{options;constructor(t){super(),this.options={diff:100},Object.assign(this.options,t)}get status(){return{running:this.isRunning,complete:this.isComplete}}get value(){return this.timeDiff>=this.options.diff&&(this.startTime=this.time,!0)}}const q={x:.5,y:.515},K={x:.5,y:.328};class J extends g{instructImage;getReadyImage;opacity;fadeOut;isComplete;doesTap;constructor(){super(),this.instructImage={size:.4,position:{x:0,y:0},image:void 0,scaled:{width:0,height:0}},this.getReadyImage={size:.65,position:{x:0,y:0},image:void 0,scaled:{width:0,height:0}},this.fadeOut=new V({transition:"linear"}),this.opacity=1,this.isComplete=!1,this.doesTap=!1}init(){this.instructImage.image=p.asset("banner-instruction"),this.getReadyImage.image=p.asset("banner-game-ready")}reset(){this.opacity=1,this.isComplete=!1,this.doesTap=!1}tap(){this.isComplete||(this.fadeOut.start(),this.isComplete=!0,this.doesTap=!0)}resize({width:t,height:e}){super.resize({width:t,height:e}),this.instructImage.scaled=o({width:this.instructImage.image.width,height:this.instructImage.image.height},{width:t*this.instructImage.size}),this.getReadyImage.scaled=o({width:this.getReadyImage.image.width,height:this.getReadyImage.image.height},{width:t*this.getReadyImage.size});const i=q,s=K;this.instructImage.position.x=t*i.x-this.instructImage.scaled.width/2,this.instructImage.position.y=e*i.y-this.instructImage.scaled.height/2,this.getReadyImage.position.x=t*s.x-this.getReadyImage.scaled.width/2,this.getReadyImage.position.y=e*s.y-this.getReadyImage.scaled.height/2}Update(t){this.doesTap?this.opacity=this.fadeOut.value:this.opacity=1}Display(t){if(this.opacity<=0)return;t.globalAlpha=this.opacity;const e=.1*this.canvasSize.width;t.font=`bold ${e}px monospace`,t.textAlign="center",t.fillStyle="#FF0000",t.shadowColor="#8B0000",t.shadowBlur=4,t.fillText("Unfair",.5*this.canvasSize.width,this.getReadyImage.position.y-.5*e),t.shadowBlur=0,t.drawImage(this.getReadyImage.image,this.getReadyImage.position.x,this.getReadyImage.position.y,this.getReadyImage.scaled.width,this.getReadyImage.scaled.height),t.drawImage(this.instructImage.image,this.instructImage.position.x,this.instructImage.position.y,this.instructImage.scaled.width,this.instructImage.scaled.height),t.globalAlpha=1}}class Q extends g{currentValue;numberAsset;numberDimension;constructor(){super(),this.currentValue=0,this.numberAsset={},this.numberDimension={width:0,height:0}}init(){this.setInitAsset(0,"number-lg-0"),this.setInitAsset(1,"number-lg-1"),this.setInitAsset(2,"number-lg-2"),this.setInitAsset(3,"number-lg-3"),this.setInitAsset(4,"number-lg-4"),this.setInitAsset(5,"number-lg-5"),this.setInitAsset(6,"number-lg-6"),this.setInitAsset(7,"number-lg-7"),this.setInitAsset(8,"number-lg-8"),this.setInitAsset(9,"number-lg-9")}setInitAsset(t,e){this.numberAsset[String(t)]=p.asset(e)}setNum(t){this.currentValue=t}resize({width:t,height:e}){super.resize({width:t,height:e}),this.numberDimension=o(d,{height:.065*e}),this.coordinate.x=.5*this.canvasSize.width,this.coordinate.y=.18*this.canvasSize.height}Update(t){}Display(t){const e=String(this.currentValue).split(""),i=e.length*this.numberDimension.width;let s=this.coordinate.x-i/2;const n=this.coordinate.y-this.numberDimension.height/2;e.forEach((e=>{t.drawImage(this.numberAsset[e],s,n,this.numberDimension.width,this.numberDimension.height),s+=this.numberDimension.width}))}}class tt extends g{fadeEvent;strong;style;events;value;constructor({style:t,strong:e,interval:i,easing:s}){super(),this.strong=e,this.style=t,this.events=[],this.fadeEvent=new V({duration:i,transition:s}),this.value=0}init(){}reset(){this.fadeEvent.reset();for(const t of this.events)t.isCalled=!1}start(){this.fadeEvent.start()}setEvent(t,e){this.events.push({range:{min:t[0],max:t[1]},callback:e,isCalled:!1})}get status(){return{...this.fadeEvent.status,value:this.value}}Update(t){if(!this.status.complete||this.status.running){this.value=this.fadeEvent.value;for(const t of this.events)t.isCalled||t.range.min<=this.value&&t.range.max>=this.value&&(t.callback(),t.isCalled=!0)}else this.value=0}Display(t){t.globalAlpha=this.strong*this.value,t.fillStyle=this.style,t.fillRect(0,0,this.canvasSize.width,this.canvasSize.height),t.fill(),t.globalAlpha=1}}class et extends g{images;scaled;status;timingEvent;sparkList;currentSparkIndex;dimension;target;constructor(){super(),this.images=new Map,this.timingEvent=new Z({diff:200}),this.scaled={width:0,height:0},this.dimension={width:0,height:0},this.target={x:0,y:0},this.status="stopped",this.sparkList=[],this.currentSparkIndex=0}init(){this.images.set("spark-sm",p.asset("spark-sm")),this.images.set("spark-md",p.asset("spark-md")),this.images.set("spark-lg",p.asset("spark-lg")),this.sparkList=["spark-sm","spark-md","spark-lg","spark-md","spark-sm"]}resize({width:t,height:e}){super.resize({width:t,height:e}),this.scaled=o({width:this.images.get("spark-lg").width,height:this.images.get("spark-lg").height},{width:.03*t})}doSpark(){"running"!==this.status&&(this.status="running",this.timingEvent.start())}stop(){this.status="stopped",this.timingEvent.reset()}relocate(){this.target.x=m(this.coordinate.x,this.coordinate.x+this.dimension.width),this.target.y=m(this.coordinate.y,this.coordinate.y+this.dimension.height)}move({x:t,y:e},i){this.coordinate={x:t,y:e},this.dimension=i}Update(t){"stopped"!==this.status&&this.timingEvent.value&&(this.currentSparkIndex>this.sparkList.length-2?(this.currentSparkIndex=0,this.relocate()):this.currentSparkIndex++)}Display(t){"stopped"!==this.status&&t.drawImage(this.images.get(this.sparkList[this.currentSparkIndex]),Math.abs(this.target.x-this.scaled.width/2),Math.abs(this.target.y-this.scaled.height/2),this.scaled.width,this.scaled.height)}}class it{active;coordinate;img;initialWidth;dimension;calcCoord;canvasSize;touchStart;hoverState;additionalTranslate;constructor(){this.coordinate={x:0,y:0},this.calcCoord={x:0,y:0},this.dimension={width:0,height:0},this.canvasSize={width:0,height:0},this.additionalTranslate={x:0,y:0},this.touchStart={x:0,y:0},this.active=!1,this.img=void 0,this.hoverState=!1,this.initialWidth=0}get isHovered(){return this.hoverState}resize({width:t,height:e}){void 0!==this.img&&(this.dimension=o({width:this.img.width,height:this.img.height},{width:t*this.initialWidth})),this.canvasSize={width:t,height:e}}Update(){this.calcCoord.x=this.canvasSize.width*this.coordinate.x+this.additionalTranslate.x,this.calcCoord.y=this.canvasSize.height*this.coordinate.y+this.additionalTranslate.y}mouseEvent(t,{x:e,y:i}){"down"===t?this.onMouseDown({x:e,y:i}):"up"===t&&this.onMouseup({x:e,y:i})}reset(){this.move({x:0,y:0})}move({x:t,y:e}){this.additionalTranslate.x=this.canvasSize.width*t,this.additionalTranslate.y=this.canvasSize.height*e}isInRange({x:t,y:e}){const i=this.calcCoord.x,s=this.calcCoord.y,n=this.dimension.width/2,a=this.dimension.height/2;return i-n<t&&i+n>t&&s-a<e&&s+a>e}onMouseDown(t){this.active&&(this.touchStart=t,this.isInRange(t)&&(this.hoverState=!0))}onMouseup(t){this.active&&(this.hoverState=!1,this.isInRange(t)&&this.isInRange(this.touchStart)&&this.click())}}class st extends it{callback;constructor(){super(),this.initialWidth=.38,this.coordinate={x:.259,y:.6998},this.active=!0}click(){P.swoosh(),this.callback?.()}onClick(t){this.callback=t}init(){this.img=p.asset("btn-play")}Update(){this.reset(),this.isHovered&&this.move({x:0,y:.004}),super.Update()}Display(t){const e=this.calcCoord.x,i=this.calcCoord.y,s=this.dimension.width/2,n=this.dimension.height/2;t.drawImage(this.img,e-s,i-n,2*s,2*n)}}class nt extends st{constructor(){super(),this.coordinate.x=.741}init(){this.img=p.asset("btn-ranking")}}class at extends it{assets;is_mute;constructor(){super(),this.initialWidth=.1,this.assets=new Map,this.is_mute=!1,this.coordinate.x=.93,this.coordinate.y=.04,this.active=!0}click(){P.swoosh(),this.is_mute=!this.is_mute,P.currentVolume=this.is_mute?0:1}setImg(){const t=this.is_mute?"mute":"unmute";this.img=this.assets.get(t)}init(){this.assets.set("mute",p.asset("btn-mute")),this.assets.set("unmute",p.asset("btn-speaker")),this.setImg()}Update(){this.reset(),this.isHovered&&this.move({x:0,y:.004}),this.setImg(),super.Update()}Display(t){const e=this.calcCoord.x,i=this.calcCoord.y,s=this.dimension.width/2,n=this.dimension.height/2;t.drawImage(this.img,e-s,i-n,2*s,2*n)}}class ot{static sk=window.location.href.toString().match(/([a-zA-Z-]+\.github\.io\/[a-zA-Z\-.]+\/)/i);static isAvailable;constructor(){(ot.sk??[]).length<1&&(ot.sk=["brrrrrrrrrrr"]),ot.sk=ot.utoa(ot.sk[0]),ot.isAvailable=!1;try{"localStorage"in window&&"object"==typeof window.localStorage&&(ot.isAvailable=!0)}catch(t){ot.isAvailable=!1}}static utoa(t){return btoa(encodeURIComponent(t))}static atou(t){return decodeURIComponent(atob(t))}static save(t,e){if(!ot.isAvailable)return void console.warn("Storage is not available");const i=typeof e;"string"!=typeof e&&(e=String(e)),window.localStorage.setItem(`__${ot.sk}_${t}__`,ot.utoa(JSON.stringify({mode:i,value:e})))}static get(t){if(ot.isAvailable)try{const e=window.localStorage.getItem(`__${ot.sk}_${t}__`);if(!e)return;const i=JSON.parse(ot.atou(e));let s;switch(i.type){case"string":s=String(i.value);break;case"number":s=Number(i.value);break;case"boolean":s="true"===i.value}return s}catch(t){return void console.error("Failed to fetch highscore")}else console.warn("Storage is not available")}}class ht extends it{assets;is_active;constructor(){super(),this.initialWidth=.098,this.assets=new Map,this.is_active=a.SHOW_FPS,this.coordinate.x=.92,this.coordinate.y=.1,this.active=!0}click(){P.swoosh(),this.is_active=!this.is_active,a.SHOW_FPS=this.is_active}setImg(){const t=this.is_active?"enable":"disable";this.img=this.assets.get(t)}init(){this.assets.set("disable",p.asset("btn-fps-disable")),this.assets.set("enable",p.asset("btn-fps-enable")),this.setImg()}Update(){this.reset(),this.isHovered&&this.move({x:0,y:.004}),this.setImg(),super.Update()}Display(t){const e=this.calcCoord.x,i=this.calcCoord.y,s=this.dimension.width/2,n=this.dimension.height/2;t.drawImage(this.img,e-s,i-n,2*s,2*n)}}var rt=i(146),ct=i.n(rt);const lt=(Symbol("solid-proxy"),Symbol("solid-track"),Symbol("solid-dev-component"),{equals:(t,e)=>t===e});let dt=Mt;const ut=1,gt=2,pt={owned:null,cleanups:null,context:null,owner:null};var mt=null;let ft=null,vt=null,wt=null,yt=null,bt=null,St=null,xt=0;function Ct(t,e){const i={value:t,observers:null,observerSlots:null,comparator:(e=e?Object.assign({},lt,e):lt).equals||void 0};return[zt.bind(i),t=>("function"==typeof t&&(t=ft&&ft.running&&ft.sources.has(i)?t(i.tValue):t(i.value)),Dt(i,t))]}function At(t,e,i){i=i?Object.assign({},lt,i):lt;const s=function(t,e,i,s=ut){const n={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:mt,context:mt?mt.context:null,pure:i};if(ft&&ft.running&&(n.state=0,n.tState=s),null===mt||mt!==pt&&(ft&&ft.running&&mt.pure?mt.tOwned?mt.tOwned.push(n):mt.tOwned=[n]:mt.owned?mt.owned.push(n):mt.owned=[n]),wt&&n.fn){const[t,e]=Ct(void 0,{equals:!1}),i=wt.factory(n.fn,e);It((()=>i.dispose()));const s=()=>function(t){if(ft&&ft.running)return t(),ft.done;const e=yt,i=mt;return Promise.resolve().then((()=>{let s;return yt=e,mt=i,(vt||Et)&&(s=ft||(ft={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),s.done||(s.done=new Promise((t=>s.resolve=t))),s.running=!0),Bt(t,!1),yt=mt=null,s?s.done:void 0}))}(e).then((()=>a.dispose())),a=wt.factory(n.fn,s);n.fn=e=>(t(),ft&&ft.running?a.track(e):i.track(e))}return n}(t,e,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=i.equals||void 0,vt&&ft&&ft.running?(s.tState=ut,bt.push(s)):Tt(s),zt.bind(s)}function It(t){return null===mt||(null===mt.cleanups?mt.cleanups=[t]:mt.cleanups.push(t)),t}const[Ot,kt]=Ct(!1);let Et;function zt(){const t=ft&&ft.running;if(this.sources&&(t?this.tState:this.state))if((t?this.tState:this.state)===ut)Tt(this);else{const t=bt;bt=null,Bt((()=>Lt(this)),!1),bt=t}if(yt){const t=this.observers?this.observers.length:0;yt.sources?(yt.sources.push(this),yt.sourceSlots.push(t)):(yt.sources=[this],yt.sourceSlots=[t]),this.observers?(this.observers.push(yt),this.observerSlots.push(yt.sources.length-1)):(this.observers=[yt],this.observerSlots=[yt.sources.length-1])}return t&&ft.sources.has(this)?this.tValue:this.value}function Dt(t,e,i){let s=ft&&ft.running&&ft.sources.has(t)?t.tValue:t.value;if(!t.comparator||!t.comparator(s,e)){if(ft){const s=ft.running;(s||!i&&ft.sources.has(t))&&(ft.sources.add(t),t.tValue=e),s||(t.value=e)}else t.value=e;t.observers&&t.observers.length&&Bt((()=>{for(let e=0;e<t.observers.length;e+=1){const i=t.observers[e],s=ft&&ft.running;s&&ft.disposed.has(i)||((s?i.tState:i.state)||(i.pure?bt.push(i):St.push(i),i.observers&&Rt(i)),s?i.tState=ut:i.state=ut)}if(bt.length>1e6)throw bt=[],new Error}),!1)}return e}function Tt(t){if(!t.fn)return;Ft(t);const e=xt;Pt(t,ft&&ft.running&&ft.sources.has(t)?t.tValue:t.value,e),ft&&!ft.running&&ft.sources.has(t)&&queueMicrotask((()=>{Bt((()=>{ft&&(ft.running=!0),yt=mt=t,Pt(t,t.tValue,e),yt=mt=null}),!1)}))}function Pt(t,e,i){let s;const n=mt,a=yt;yt=mt=t;try{s=t.fn(e)}catch(e){return t.pure&&(ft&&ft.running?(t.tState=ut,t.tOwned&&t.tOwned.forEach(Ft),t.tOwned=void 0):(t.state=ut,t.owned&&t.owned.forEach(Ft),t.owned=null)),t.updatedAt=i+1,Ht(e)}finally{yt=a,mt=n}(!t.updatedAt||t.updatedAt<=i)&&(null!=t.updatedAt&&"observers"in t?Dt(t,s,!0):ft&&ft.running&&t.pure?(ft.sources.add(t),t.tValue=s):t.value=s,t.updatedAt=i)}function _t(t){const e=ft&&ft.running;if(0===(e?t.tState:t.state))return;if((e?t.tState:t.state)===gt)return Lt(t);if(t.suspense&&function(t){if(!wt&&null===yt)return t();const e=yt;yt=null;try{return wt?wt.untrack(t):t()}finally{yt=e}}(t.suspense.inFallback))return t.suspense.effects.push(t);const i=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<xt);){if(e&&ft.disposed.has(t))return;(e?t.tState:t.state)&&i.push(t)}for(let s=i.length-1;s>=0;s--){if(t=i[s],e){let e=t,n=i[s+1];for(;(e=e.owner)&&e!==n;)if(ft.disposed.has(e))return}if((e?t.tState:t.state)===ut)Tt(t);else if((e?t.tState:t.state)===gt){const e=bt;bt=null,Bt((()=>Lt(t,i[0])),!1),bt=e}}}function Bt(t,e){if(bt)return t();let i=!1;e||(bt=[]),St?i=!0:St=[],xt++;try{const e=t();return function(t){if(bt&&(vt&&ft&&ft.running?function(t){for(let e=0;e<t.length;e++){const i=t[e],s=ft.queue;s.has(i)||(s.add(i),vt((()=>{s.delete(i),Bt((()=>{ft.running=!0,_t(i)}),!1),ft&&(ft.running=!1)})))}}(bt):Mt(bt),bt=null),t)return;let e;if(ft)if(ft.promises.size||ft.queue.size){if(ft.running)return ft.running=!1,ft.effects.push.apply(ft.effects,St),St=null,void kt(!0)}else{const t=ft.sources,i=ft.disposed;St.push.apply(St,ft.effects),e=ft.resolve;for(const t of St)"tState"in t&&(t.state=t.tState),delete t.tState;ft=null,Bt((()=>{for(const t of i)Ft(t);for(const e of t){if(e.value=e.tValue,e.owned)for(let t=0,i=e.owned.length;t<i;t++)Ft(e.owned[t]);e.tOwned&&(e.owned=e.tOwned),delete e.tValue,delete e.tOwned,e.tState=0}kt(!1)}),!1)}const i=St;St=null,i.length&&Bt((()=>dt(i)),!1),e&&e()}(i),e}catch(t){i||(St=null),bt=null,Ht(t)}}function Mt(t){for(let e=0;e<t.length;e++)_t(t[e])}function Lt(t,e){const i=ft&&ft.running;i?t.tState=0:t.state=0;for(let s=0;s<t.sources.length;s+=1){const n=t.sources[s];if(n.sources){const t=i?n.tState:n.state;t===ut?n!==e&&(!n.updatedAt||n.updatedAt<xt)&&_t(n):t===gt&&Lt(n,e)}}}function Rt(t){const e=ft&&ft.running;for(let i=0;i<t.observers.length;i+=1){const s=t.observers[i];(e?s.tState:s.state)||(e?s.tState=gt:s.state=gt,s.pure?bt.push(s):St.push(s),s.observers&&Rt(s))}}function Ft(t){let e;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),i=t.sourceSlots.pop(),s=e.observers;if(s&&s.length){const t=s.pop(),n=e.observerSlots.pop();i<s.length&&(t.sourceSlots[n]=i,s[i]=t,e.observerSlots[i]=n)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ft(t.tOwned[e]);delete t.tOwned}if(ft&&ft.running&&t.pure)Gt(t,!0);else if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ft(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}ft&&ft.running?t.tState=0:t.state=0}function Gt(t,e){if(e||(t.tState=0,ft.disposed.add(t)),t.owned)for(let e=0;e<t.owned.length;e++)Gt(t.owned[e])}function Ht(t,e=mt){const i=function(t){return t instanceof Error?t:new Error("string"==typeof t?t:"Unknown error",{cause:t})}(t);throw i}Symbol("fallback"),Object.create(null),Object.create(null),Symbol(),Object.entries,Object.keys;class Ut{static IS_LOCK=!0;loop_function;last_time;begin_time;primitiveRaf;constructor(){this.last_time=0,this.begin_time=0,this.loop_function=(t,e)=>{},this.primitiveRaf=function(t){const[e,i]=Ct(!1);let s=0;const n=e=>{s=requestAnimationFrame(n),t(e)},a=()=>{i(!1),cancelAnimationFrame(s)};return It(a),[e,()=>{e()||(i(!0),s=requestAnimationFrame(n))},a]}(function(t,e){const i="function"==typeof e?At((()=>Math.floor(1e3/e()))):(()=>{const t=Math.floor(1e3/e);return()=>t})();let s=0,n=0,a=0;return e=>{s=e-n,Math.ceil(s+a)>=i()&&(n=e,a=Math.max(s-i(),0),t(e))}}(this.loop.bind(this),60))}add_loop_function(t){this.loop_function=t}loop(){const t=performance.now(),e=(t-this.last_time)/1e3;this.last_time=t,this.loop_function(e,(t-this.begin_time)/1e3),Ut.IS_LOCK?this.primitiveRaf[1]():(this.primitiveRaf[2](),ct()(this.loop.bind(this)))}start(){this.last_time=performance.now(),this.begin_time=this.last_time,this.primitiveRaf[0]()||this.primitiveRaf[1]()}}class Nt extends it{assets;is_active;constructor(){super(),this.initialWidth=.098,this.assets=new Map,this.is_active=Ut.IS_LOCK,this.coordinate.x=.92,this.coordinate.y=.15,this.active=!0}click(){P.swoosh(),this.is_active=!this.is_active,Ut.IS_LOCK=this.is_active}setImg(){const t=this.is_active?"locked":"unlocked";this.img=this.assets.get(t)}init(){this.assets.set("unlocked",p.asset("btn-fps-unlocked")),this.assets.set("locked",p.asset("btn-fps-locked")),this.setImg()}Update(){this.reset(),this.isHovered&&this.move({x:0,y:.004}),this.setImg(),super.Update()}Display(t){const e=this.calcCoord.x,i=this.calcCoord.y,s=this.dimension.width/2,n=this.dimension.height/2;t.drawImage(this.img,e-s,i-n,2*s,2*n)}}class Wt extends g{static FLAG_SHOW_BANNER=1;static FLAG_SHOW_SCOREBOARD=2;static FLAG_SHOW_BUTTONS=4;static FLAG_NEW_HIGH_SCORE=8;flags;images;playButton;rankingButton;toggleSpeakerButton;toggleFpsBtn;toggleLockFpsBtn;FlyInAnim;BounceInAnim;currentScore;currentGeneratedNumber;currentHighScore;TimingEventAnim;spark;buttonArray;constructor(){super(),this.flags=0,this.images=new Map,this.playButton=new st,this.rankingButton=new nt,this.toggleSpeakerButton=new at,this.toggleFpsBtn=new ht,this.toggleLockFpsBtn=new Nt,this.spark=new et,this.buttonArray=[this.playButton,this.rankingButton,this.toggleFpsBtn,this.toggleSpeakerButton,this.toggleLockFpsBtn],this.currentHighScore=0,this.currentGeneratedNumber=0,this.currentScore=0,this.FlyInAnim=new j({duration:500,from:{x:.5,y:1.5},to:{x:.5,y:.438},transition:"easeOutExpo"}),this.TimingEventAnim=new Z({diff:30}),this.BounceInAnim=new X({durations:{bounce:300,fading:100}})}init(){this.images.set("banner-gameover",p.asset("banner-game-over")),this.images.set("score-board",p.asset("score-board")),this.images.set("coin-10",p.asset("coin-dull-bronze")),this.images.set("coin-20",p.asset("coin-dull-metal")),this.images.set("coin-30",p.asset("coin-shine-gold")),this.images.set("coin-40",p.asset("coin-shine-silver")),this.images.set("new-icon",p.asset("toast-new"));for(let t=0;t<10;++t)this.images.set(`number-${t}`,p.asset(`number-md-${t}`));for(const t of this.buttonArray)t.init(),t.active=!1;this.spark.init();const t=ot.get("highscore");this.currentHighScore="number"==typeof t?t:0}resize({width:t,height:e}){super.resize({width:t,height:e}),this.spark.resize(this.canvasSize);for(const t of this.buttonArray)t.resize(this.canvasSize)}Update(t){this.spark.Update(t);for(const t of this.buttonArray)t.Update()}Display(t){if(this.flags&Wt.FLAG_SHOW_BANNER){const e=o({width:this.images.get("banner-gameover").width,height:this.images.get("banner-gameover").height},{width:.7*this.canvasSize.width}),i=this.BounceInAnim.value,s=.225*this.canvasSize.height-e.height/2;t.globalAlpha=i.opacity,t.drawImage(this.images.get("banner-gameover"),.5*this.canvasSize.width-e.width/2,s+i.value*(.015*this.canvasSize.height),e.width,e.height),t.globalAlpha=1}if(this.flags&Wt.FLAG_SHOW_SCOREBOARD){const e=o({width:this.images.get("score-board").width,height:this.images.get("score-board").height},{width:.85*this.canvasSize.width}),i=Object.assign({},this.FlyInAnim.value);i.x=this.canvasSize.width*i.x-e.width/2,i.y=this.canvasSize.height*i.y-e.height/2,t.drawImage(this.images.get("score-board"),i.x,i.y,e.width,e.height),this.TimingEventAnim.value&&this.currentScore>this.currentGeneratedNumber&&this.currentGeneratedNumber++,this.TimingEventAnim.status.complete&&!this.TimingEventAnim.status.running&&(this.currentGeneratedNumber>this.currentHighScore&&(this.setHighScore(this.currentGeneratedNumber),this.flags|=Wt.FLAG_NEW_HIGH_SCORE),this.addMedal(t,i,e),this.showButtons()),this.displayScore(t,i,e),this.displayBestScore(t,i,e,!!(this.flags&Wt.FLAG_NEW_HIGH_SCORE)),this.FlyInAnim.status.complete&&!this.FlyInAnim.status.running&&(this.TimingEventAnim.start(),this.currentGeneratedNumber===this.currentScore&&this.TimingEventAnim.stop())}if(this.flags&Wt.FLAG_SHOW_BUTTONS)for(const e of this.buttonArray)e.Display(t)}showBanner(){this.flags|=Wt.FLAG_SHOW_BANNER,this.BounceInAnim.start()}showBoard(){this.flags|=Wt.FLAG_SHOW_SCOREBOARD,this.FlyInAnim.start(),this.spark.doSpark()}showButtons(){this.flags|=Wt.FLAG_SHOW_BUTTONS;for(const t of this.buttonArray)t.active=!0}setHighScore(t){ot.save("highscore",t),this.currentHighScore=t}setScore(t){this.currentScore=t}addMedal(t,e,i){if(this.currentScore<10)return;let s;s=this.currentScore>=10&&this.currentScore<20?this.images.get("coin-10"):this.currentScore>=20&&this.currentScore<30?this.images.get("coin-20"):Math.floor(this.currentScore/10)%2==0?this.images.get("coin-40"):this.images.get("coin-30");const n=o({width:s.width,height:s.height},{width:.1878*i.width}),a={x:.36*(e.x+i.width/2),y:.9196*(e.y+i.height/2)};t.drawImage(s,a.x,a.y,n.width,n.height),this.spark.move(a,n),this.spark.Display(t)}displayScore(t,e,i){const s=o({width:this.images.get("number-1").width,height:this.images.get("number-1").height},{width:.05*i.width});(e=Object.assign({},e)).x=1.565*(e.x+i.width/2),e.y=.864*(e.y+i.height/2),String(this.currentGeneratedNumber).split("").reverse().forEach(((i,n)=>{t.drawImage(this.images.get(`number-${i}`),e.x-n*(s.width+5),e.y,s.width,s.height)}))}displayBestScore(t,e,i,s){const n=o({width:this.images.get("number-1").width,height:this.images.get("number-1").height},{width:.05*i.width});if((e=Object.assign({},e)).x=1.565*(e.x+i.width/2),e.y=1.074*(e.y+i.height/2),String(this.currentHighScore).split("").reverse().forEach(((i,s)=>{t.drawImage(this.images.get(`number-${i}`),e.x-s*(n.width+5),e.y,n.width,n.height)})),!(this.flags&Wt.FLAG_NEW_HIGH_SCORE))return;const a=o({width:this.images.get("new-icon").width,height:this.images.get("new-icon").height},{width:.14*i.width});t.drawImage(this.images.get("new-icon"),.73*e.x,.922*e.y,a.width,a.height)}hide(){this.flags=0;for(const t of this.buttonArray)t.active=!1;this.currentGeneratedNumber=0,this.FlyInAnim.reset(),this.BounceInAnim.reset(),this.TimingEventAnim.reset(),this.spark.stop()}onRestart(t){this.playButton.onClick(t)}onShowRanks(t){}mouseDown(t){for(const e of this.buttonArray)e.mouseEvent("down",t)}mouseUp(t){for(const e of this.buttonArray)e.mouseEvent("up",t)}triggerPlayATKeyboardEvent(){this.flags&Wt.FLAG_SHOW_BUTTONS&&this.playButton.click()}}var Vt;!function(t){t.blackout="blackout",t.birdInvisible="birdInvisible",t.screenGlitch="screenGlitch",t.screenOffset="screenOffset",t.flicker="flicker",t.staticNoise="staticNoise",t.screenShake="screenShake",t.blur="blur",t.invert="invert",t.zoom="zoom",t.doubleVision="doubleVision",t.colorShift="colorShift",t.vignette="vignette",t.pixelate="pixelate",t.scanlines="scanlines",t.extremeContrast="extremeContrast",t.rainbow="rainbow"}(Vt||(Vt={}));const $t=[Vt.blackout,Vt.screenGlitch,Vt.screenOffset,Vt.flicker,Vt.staticNoise,Vt.screenShake,Vt.blur,Vt.invert,Vt.zoom,Vt.doubleVision,Vt.colorShift,Vt.vignette,Vt.pixelate,Vt.scanlines,Vt.extremeContrast,Vt.rainbow];class Yt extends g{bird;pipeGenerator;state;gameState;count;game;bannerInstruction;scoreBoard;transition;hideBird;flashScreen;showScoreBoard;constructor(t){super(),this.state="waiting",this.bird=new _,this.count=new Q,this.game=t,this.pipeGenerator=this.game.pipeGenerator,this.bannerInstruction=new J,this.gameState="none",this.scoreBoard=new Wt,this.transition=new tt({interval:500,strong:1,style:"black",easing:"sineWaveHS"}),this.flashScreen=new tt({style:"white",interval:180,strong:.7,easing:"linear"}),this.hideBird=!1,this.showScoreBoard=!1,this.transition.setEvent([.99,1],this.reset.bind(this))}init(){this.bird.init(),this.count.init(),this.bannerInstruction.init(),this.scoreBoard.init(),this.setButtonEvent(),this.flashScreen.init(),this.transition.init(),this.bird.onPipePassed=()=>{this.triggerVisualChaos()}}reset(){this.gameState="none",this.state="waiting",this.game.background.reset(),this.game.platform.reset(),this.pipeGenerator.reset(),this.bannerInstruction.reset(),this.game.bgPause=!1,this.hideBird=!1,this.showScoreBoard=!1,this.scoreBoard.hide(),this.bird.reset()}resize({width:t,height:e}){super.resize({width:t,height:e}),this.bird.resize(this.canvasSize),this.count.resize(this.canvasSize),this.bannerInstruction.resize(this.canvasSize),this.scoreBoard.resize(this.canvasSize),this.flashScreen.resize(this.canvasSize),this.transition.resize(this.canvasSize)}updateReverseZone(){if("playing"!==this.state)return;const t=this.bird.rotatedDimension(),e=t.width-t.height/2,i=this.pipeGenerator.getReverseZonePipe(this.bird.coordinate.x,this.bird.coordinate.y,e);this.bird.setReverseZone(null!==i)}handleMagnetPipes(){if("playing"===this.state)for(const t of this.pipeGenerator.pipes)if(t.chaosEvents.includes("magnetPipe")){const e=Math.abs(t.coordinate.x-this.bird.coordinate.x);if(e<150){const i=(150-e)/150*3,s=t.coordinate.y>this.bird.coordinate.y?1:-1;this.bird.coordinate.y+=i*s}}}triggerVisualChaos(){if("playing"!==this.state)return;const t=function(){const t=[],e=Date.now();let i=1;Math.random()<.1&&(i=2),i=Math.min(i,2);const s=[...$t];for(let n=0;n<i&&s.length>0;n++){const i=Math.floor(Math.random()*s.length),n=s.splice(i,1)[0],a=500+1e3*Math.random();t.push({type:n,durationMs:a,startTime:e,active:!0})}return t}(this.bird.score);this.game.visualChaos.addEvents(t)}Update(t){if(this.flashScreen.Update(t),this.transition.Update(t),this.scoreBoard.Update(t),!this.bird.alive)return this.game.bgPause=!0,void this.bird.Update(t);"waiting"!==this.state?(this.updateReverseZone(),this.handleMagnetPipes(),this.bannerInstruction.Update(t),this.pipeGenerator.Update(t,this.bird.coordinate.x),this.triggerVisualChaos(),this.bird.Update(t),this.bird.isDead(this.pipeGenerator.pipes)&&(this.flashScreen.reset(),this.flashScreen.start(),this.gameState="died",window.setTimeout((()=>{this.scoreBoard.setScore(this.bird.score),this.showScoreBoard=!0,window.setTimeout((()=>{this.scoreBoard.showBoard(),P.swoosh()}),700),this.scoreBoard.showBanner(),P.swoosh()}),500),P.hit((()=>{this.bird.playDead()})))):this.bird.doWave({x:this.bird.coordinate.x,y:.48*this.canvasSize.height},1,6)}Display(t){"playing"!==this.state&&"waiting"!==this.state||(this.bannerInstruction.Display(t),"died"===this.gameState&&this.showScoreBoard||(this.count.setNum(this.bird.score),this.count.Display(t)),!this.hideBird&&!this.game.visualChaos.isBirdInvisible()&&this.bird.Display(t),this.scoreBoard.Display(t)),this.flashScreen.Display(t),this.transition.Display(t)}setButtonEvent(){this.scoreBoard.onRestart((()=>{this.transition.status.running||(this.transition.reset(),this.transition.start())}))}click({x:t,y:e}){"died"!==this.gameState&&(this.state="playing",this.gameState="playing",this.bannerInstruction.tap(),this.bird.triggerChaosEvents(),this.triggerVisualChaos(),this.triggerVisualChaos(),this.triggerVisualChaos(),this.bird.flap(),"playing"===this.state&&this.triggerVisualChaos())}mouseDown({x:t,y:e}){this.scoreBoard.mouseDown({x:t,y:e})}mouseUp({x:t,y:e}){this.scoreBoard.mouseUp({x:t,y:e})}startAtKeyBoardEvent(){"died"===this.gameState&&this.scoreBoard.triggerPlayATKeyboardEvent()}}class jt extends st{constructor(){super(),this.initialWidth=.24,this.coordinate.x=.5,this.coordinate.y=.53}init(){this.img=p.asset("btn-rate")}click(){Object.assign(document.createElement("a"),{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/jxmked/Flappybird"}).click()}}class Xt extends g{playButton;rankingButton;rateButton;toggleSpeakerButton;toggleFpsBtn;toggleLockFpsBtn;btnArray;bird;flappyBirdBanner;constructor(){super(),this.bird=new _,this.playButton=new st,this.rankingButton=new nt,this.rateButton=new jt,this.toggleSpeakerButton=new at,this.toggleFpsBtn=new ht,this.toggleLockFpsBtn=new Nt,this.flappyBirdBanner=void 0,this.btnArray=[this.playButton,this.rateButton,this.rankingButton,this.toggleFpsBtn,this.toggleSpeakerButton,this.toggleLockFpsBtn]}init(){this.bird.init();for(const t of this.btnArray)t.init();this.flappyBirdBanner=p.asset("banner-flappybird")}resize(t){super.resize(t),this.bird.resize(t);for(const e of this.btnArray)e.resize(t)}Update(){this.bird.doWave({x:.5*this.canvasSize.width,y:.4*this.canvasSize.height},1.4,9);for(const t of this.btnArray)t.Update()}Display(t){for(const e of this.btnArray)e.Display(t);this.bird.Display(t);const e=.12*this.canvasSize.width;t.font=`bold ${e}px monospace`,t.textAlign="center",t.fillStyle="#FF0000",t.shadowColor="#8B0000",t.shadowBlur=4,t.fillText("Unfair",.5*this.canvasSize.width,.15*this.canvasSize.height),t.shadowBlur=0;const i=o({width:this.flappyBirdBanner.width,height:this.flappyBirdBanner.height},{width:.67*this.canvasSize.width});t.drawImage(this.flappyBirdBanner,.5*this.canvasSize.width-i.width/2,.28*this.canvasSize.height-i.height/2,i.width,i.height),t.save(),t.font=`bold ${.035*this.canvasSize.width}px monospace`,t.textAlign="center",t.fillStyle="#666666",t.fillText("(c) VCMR 2026",.5*this.canvasSize.width,.85*this.canvasSize.height),t.restore(),this.insertAppVersion(t)}insertAppVersion(t){const e=.04*this.canvasSize.width,i=.985*this.canvasSize.height,s=.985*this.canvasSize.width;t.font=`bold ${e}px monospace`,t.textAlign="center",t.fillStyle="#8E8E93",t.fillText("v0.7.1",s-2*e,i)}mouseDown(t){for(const e of this.btnArray)e.mouseEvent("down",t)}mouseUp(t){for(const e of this.btnArray)e.mouseEvent("up",t)}startAtKeyBoardEvent(){this.playButton.click()}}class Zt{range;width;pipes;distance;initialXPos;canvasSize;pipeColor;spawnCount;pendingSwapPipe;constructor(){this.range={max:0,min:0},this.width=0,this.pipes=[],this.distance=0,this.initialXPos=0,this.canvasSize={width:0,height:0},this.pipeColor="green",this.spawnCount=0,this.pendingSwapPipe=null}reset(){this.pipes.splice(0,this.pipes.length),this.spawnCount=0,this.pendingSwapPipe=null,this.resize({max:this.range.max,width:this.canvasSize.width,height:this.canvasSize.height}),this.pipeColor=f.pipe}resize({max:t,width:e,height:i}){this.range={max:t,min:.194*i},this.distance=.392*e,this.width=e,this.canvasSize={width:e,height:i};for(const t of this.pipes)t.resize(this.canvasSize)}needPipe(){const t=this.pipes.length;return 0===t?(this.initialXPos=2*(this.width+O.pipeSize.width),!0):this.distance<=this.width-this.pipes[t-1].coordinate.x&&(this.initialXPos=this.width+O.pipeSize.width,!0)}generate(){return{position:{x:this.initialXPos,y:m(this.range.min,this.range.max-this.range.min)}}}getReverseZonePipe(t,e,i){for(const s of this.pipes)if(s.isInReverseZone(t,e,i))return s;return null}handlePipeSwap(){if(this.pipes.length<2)return;const t=this.pipes[this.pipes.length-2],e=this.pipes[this.pipes.length-1];if(t&&e&&t.chaosEvents.includes("pipeSwap")&&this.pendingSwapPipe!==t){const i=t.coordinate.y;t.coordinate.y=e.coordinate.y,e.coordinate.y=i,this.pendingSwapPipe=t}}Update(t,e){if(this.needPipe()){const t=new O(this.spawnCount);t.init(),t.use(this.pipeColor),t.resize(this.canvasSize),t.setHollPosition(this.generate().position),t.assignTrapTypeAndChaos(),t.setChaosEvents(function(t){const e=[],i=Math.random();let s=0;if(t<3)return[];i<.5?s=1:i<.7&&t>10&&(s=2);const n=[...C];for(let t=0;t<s&&n.length>0;t++){const t=Math.floor(Math.random()*n.length);e.push(n.splice(t,1)[0])}return e}(this.spawnCount)),this.pipes.push(t),this.handlePipeSwap(),this.spawnCount++}for(let i=0;i<this.pipes.length;i++)this.pipes[i].currentBirdX=e,this.pipes[i].Update(t),this.pipes[i].isPassed&&"snapClose"===this.pipes[i].type&&this.pipes[i].resetAfterPass(),this.pipes[i].isOut()&&(this.pipes.splice(i,1),i--)}}class qt extends g{platformSize;img;constructor(){super(),this.velocity.x=h,this.platformSize={width:0,height:0},this.img=void 0}init(){this.img=p.asset("platform")}reset(){this.coordinate={x:0,y:0},this.resize(this.canvasSize)}resize({width:t,height:e}){super.resize({width:t,height:e}),this.platformSize=o({width:this.img.width,height:this.img.height},{height:e/4}),this.coordinate.y=e-this.platformSize.height}Update(t){this.coordinate.x+=this.canvasSize.width*this.velocity.x*t,this.coordinate.y+=this.velocity.y}Display(t){const{width:e,height:i}=this.platformSize,{x:s,y:n}=this.coordinate,a=Math.ceil(this.canvasSize.width/e)+1,o=s%e;for(let s=0;s<a;s++)t.drawImage(this.img,s*(e-s)-o,n,e,i)}}class Kt{objects;currentState;constructor(){this.objects=new Map,this.currentState=""}setState(t){this.currentState=t}register(t,e){this.objects.set(t,e)}Update(t){const e=this.objects.get(this.currentState);if(void 0===e)throw new TypeError(`State ${this.currentState} does not exists`);e.Update(t)}Display(t){const e=this.objects.get(this.currentState);if(void 0===e)throw new TypeError(`State ${this.currentState} does not exists`);e.Display(t)}}class Jt{activeEvents;canvas;tempCanvas;tempContext;frameCount;constructor(t){this.canvas=t,this.activeEvents=[],this.frameCount=0,this.tempCanvas=document.createElement("canvas"),this.tempCanvas.width=t.width,this.tempCanvas.height=t.height,this.tempContext=this.tempCanvas.getContext("2d")}addEvents(t){this.activeEvents.push(...t)}update(){const t=Date.now();this.frameCount++,this.activeEvents=this.activeEvents.filter((e=>t-e.startTime<e.durationMs))}isActive(t){return this.activeEvents.some((e=>e.type===t))}isBirdInvisible(){return this.isActive(Vt.birdInvisible)}applyChaos(t){if(0===this.activeEvents.length)return;const e=this.canvas.width,i=this.canvas.height;if(this.tempContext.drawImage(this.canvas,0,0),t.clearRect(0,0,e,i),this.isActive(Vt.screenShake)){const e=60*(Math.random()-.5),i=60*(Math.random()-.5);t.save(),t.translate(e,i)}if(this.isActive(Vt.screenOffset)){const e=300*(Math.random()-.5),i=300*(Math.random()-.5);t.save(),t.translate(e,i)}if(t.drawImage(this.tempCanvas,0,0),(this.isActive(Vt.screenShake)||this.isActive(Vt.screenOffset))&&t.restore(),this.isActive(Vt.blackout)&&(t.fillStyle="rgba(0, 0, 0, 0.85)",t.fillRect(0,0,e,i)),this.isActive(Vt.flicker)&&this.frameCount%2==0&&(t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillRect(0,0,e,i)),this.isActive(Vt.screenGlitch)&&this.applyGlitch(t,e,i),this.isActive(Vt.staticNoise)&&this.applyNoise(t,e,i),this.isActive(Vt.scanlines)&&this.applyScanlines(t,e,i),this.isActive(Vt.vignette)&&this.applyVignette(t,e,i),this.isActive(Vt.invert)&&(t.globalCompositeOperation="difference",t.fillStyle="white",t.fillRect(0,0,e,i),t.globalCompositeOperation="source-over"),this.isActive(Vt.colorShift)&&(t.globalCompositeOperation="hue",t.fillStyle=`hsla(${360*Math.random()}, 100%, 50%, 0.5)`,t.fillRect(0,0,e,i),t.globalCompositeOperation="source-over"),this.isActive(Vt.rainbow)){const s=t.createLinearGradient(0,0,e,i),n=Date.now()/5%360;s.addColorStop(0,`hsla(${n}, 100%, 50%, 0.3)`),s.addColorStop(1,`hsla(${(n+180)%360}, 100%, 50%, 0.3)`),t.fillStyle=s,t.fillRect(0,0,e,i)}this.isActive(Vt.doubleVision)&&(t.globalAlpha=.5,t.drawImage(this.tempCanvas,10,0),t.drawImage(this.tempCanvas,-10,0),t.globalAlpha=1),this.isActive(Vt.zoom)&&(t.save(),t.translate(e/2,i/2),t.scale(1.3,1.3),t.translate(-e/2,-i/2),t.drawImage(this.tempCanvas,0,0),t.restore()),this.isActive(Vt.blur)&&(t.filter="blur(4px)",t.drawImage(this.tempCanvas,0,0),t.filter="none"),this.isActive(Vt.pixelate)&&this.applyPixelate(t,e,i),this.isActive(Vt.extremeContrast)&&(t.filter="contrast(200%) brightness(150%) saturate(200%)",t.drawImage(this.tempCanvas,0,0),t.filter="none")}applyGlitch(t,e,i){const s=10+Math.floor(10*Math.random());for(let n=0;n<s;n++){const s=Math.random()*i,n=5+20*Math.random(),a=50*(Math.random()-.5);t.drawImage(this.tempCanvas,0,s,e,n,a,s,e,n)}}applyNoise(t,e,i){const s=t.getImageData(0,0,e,i),n=s.data;for(let t=0;t<n.length;t+=4)if(Math.random()<.3){const e=255*Math.random();n[t]=e,n[t+1]=e,n[t+2]=e,n[t+3]=100}t.putImageData(s,0,0)}applyScanlines(t,e,i){t.fillStyle="rgba(0, 0, 0, 0.5)";for(let s=0;s<i;s+=3)t.fillRect(0,s,e,1)}applyVignette(t,e,i){const s=t.createRadialGradient(e/2,i/2,.3*e,e/2,i/2,.9*e);s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(1,"rgba(0, 0, 0, 0.8)"),t.fillStyle=s,t.fillRect(0,0,e,i)}applyPixelate(t,e,i){t.imageSmoothingEnabled=!1,t.drawImage(this.tempCanvas,0,0,e/12,i/12),t.drawImage(this.canvas,0,0,e/12,i/12,0,0,e,i),t.imageSmoothingEnabled=!0}clear(){this.activeEvents=[]}resize(t,e){this.tempCanvas.width=t,this.tempCanvas.height=e}}class Qt{__source;ready;constructor(t){this.__source=t,this.ready=0}eventTracking(t,e){this.ready--,this.ready<1&&t({source:this.source,object:e})}get source(){return this.__source}}class te extends Qt{static regexp}class ee extends te{static regexp=/\.(mp3|wav|ogg|aac)/i;test(){return ee.regexp.test(this.source)}load(){return this.ready=2,new Promise(((t,e)=>{const i=new Audio;i.addEventListener("load",(()=>{this.eventTracking(t,i)})),i.addEventListener("canplay",(()=>{this.eventTracking(t,i)})),i.addEventListener("canplaythrough",(()=>{this.eventTracking(t,i)})),i.addEventListener("error",e),i.src=this.source}))}}class ie extends te{static regexp=/\.(jpe?g|png|svg|bmp|webp|webm|gif)/i;test(){return ie.regexp.test(this.source)}load(){return this.ready=1,new Promise(((t,e)=>{const i=new Image;i.addEventListener("load",(()=>{this.eventTracking(t,i)})),i.addEventListener("error",e),i.src=this.source}))}}class se{static assets=new Map;callback;static loaders=[ee,ie];constructor(t){const e=t.map((t=>{for(const e of se.loaders){const i=new e(t);if(i.test())return i.load()}throw new Error("No available driver for file: "+t)}));Promise.all(e).then((t=>{t.forEach((t=>{se.assets.set(t.source,t.object)})),this.callback?.()})).catch((t=>{console.error(t)}))}then(t){this.callback=t}static get(t){return se.assets.get(t)}}const ne=i.p+"d37c1e0625d5ae6443c2.png",ae=document.createElement("canvas"),oe=document.createElement("img"),he=document.querySelector("#main-canvas"),re=he.getContext("2d"),ce=document.querySelector("#loading-modal"),le=new class extends g{background;platform;canvas;context;pipeGenerator;bgPause;visualChaos;screenChanger;transition;screenIntro;gamePlay;state;constructor(t){super(),this.screenChanger=new Kt,this.background=new v,this.canvas=t,this.context=this.canvas.getContext("2d",{desynchronized:!0,alpha:!1}),this.platform=new qt,this.pipeGenerator=new Zt,this.screenIntro=new Xt,this.gamePlay=new Yt(this),this.state="intro",this.bgPause=!1,this.visualChaos=new Jt(t),this.transition=new tt({interval:700,strong:1,style:"black",easing:"sineWaveHS"}),this.transition.setEvent([.98,1],(()=>{this.state="game"}))}init(){new ot,this.background.init(),this.platform.init(),this.transition.init(),P.init(),P.volume(1),this.screenIntro.init(),this.gamePlay.init(),this.setEvent(),this.screenIntro.playButton.active=!0,this.screenIntro.rankingButton.active=!0,this.screenIntro.rateButton.active=!0,this.screenChanger.register("intro",this.screenIntro),this.screenChanger.register("game",this.gamePlay)}reset(){this.background.reset(),this.platform.reset(),this.Resize(this.canvasSize)}Resize({width:t,height:e}){super.resize({width:t,height:e}),this.background.resize(this.canvasSize),this.platform.resize(this.canvasSize),this.transition.resize(this.canvasSize),_.platformHeight=this.platform.platformSize.height,this.pipeGenerator.resize({max:e-this.platform.platformSize.height,width:t,height:e}),this.screenIntro.resize(this.canvasSize),this.gamePlay.resize(this.canvasSize),this.canvas.width=t,this.canvas.height=e,this.visualChaos.resize(t,e)}Update(t){this.transition.Update(t),this.screenChanger.setState(this.state),this.bgPause||(this.background.Update(t),this.platform.Update(t)),this.screenChanger.Update(t),this.visualChaos.update()}Display(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.imageSmoothingEnabled=!1,this.context.imageSmoothingQuality="high",this.screenChanger.setState(this.state),this.background.Display(this.context);for(const t of this.pipeGenerator.pipes)t.Display(this.context);this.platform.Display(this.context),this.screenChanger.Display(this.context),this.transition.Display(this.context),this.visualChaos.applyChaos(this.context)}setEvent(){this.screenIntro.playButton.onClick((()=>{if("intro"===this.state){for(const t of this.screenIntro.btnArray)t.active=!1;this.transition.reset(),this.transition.start()}}))}onClick({x:t,y:e}){"game"===this.state&&this.gamePlay.click({x:t,y:e})}mouseDown({x:t,y:e}){this.screenIntro.mouseDown({x:t,y:e}),this.gamePlay.mouseDown({x:t,y:e})}mouseUp({x:t,y:e}){this.screenIntro.mouseUp({x:t,y:e}),this.gamePlay.mouseUp({x:t,y:e})}startAtKeyBoardEvent(){"intro"===this.state?this.screenIntro.startAtKeyBoardEvent():this.gamePlay.startAtKeyBoardEvent()}get currentState(){return this.state}}(ae),de=new a(le.context),ue=new Ut;let ge=!1;oe.src=n,de.text({x:50,y:50},""," FPS"),de.container({x:10,y:10},{x:180,y:60}),"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("./service-worker.js").then((()=>{console.log("SW registered")})).catch((()=>{console.log("SW registration failed")}))}));const pe=(t,e)=>{re.drawImage(ae,0,0),le.Update(t),le.Display(),de.PROD_SHOW_FPS()},me=()=>{const t=o(r,{height:2*window.innerHeight-50});he.style.maxWidth=String(t.width/2)+"px",he.style.maxHeight=String(t.height/2)+"px",he.height=t.height,he.width=t.width,ae.height=t.height,ae.width=t.width,console.log(`Canvas Size: ${t.width}x${t.height}`),le.Resize(t)},fe=()=>{((t,e)=>{let i=!1,s=!1,n=!0;const a={down:!1,position:{x:0,y:0}},o=({x:t,y:i})=>{const{left:s,top:n,width:a,height:o}=e.getBoundingClientRect();return{x:(t-s)/a*e.width,y:(i-n)/o*e.height}},h=({x:t,y:e},i)=>{i.preventDefault(),a.position=o({x:t,y:e})},r=({x:e,y:h},r,c)=>{n||(n=!0,s=!1,u.init(),r.preventDefault(),c||(a.position=o({x:e,y:h})),t.mouseUp(a.position),a.down=!1,i=!1)},c=({x:e,y:h},r)=>{s||(n=!1,s=!0,u.init(),r.preventDefault(),a.position=o({x:e,y:h}),t.mouseDown(a.position),a.down=!0,i||(t.onClick(a.position),i=!0))};e.addEventListener("mousedown",(t=>{c({x:t.clientX,y:t.clientY},t)})),e.addEventListener("mouseup",(t=>{r({x:t.clientX,y:t.clientY},t,!1)})),e.addEventListener("mousemove",(t=>{h({x:t.clientX,y:t.clientY},t)})),e.addEventListener("touchstart",(t=>{c({x:t.touches[0].clientX,y:t.touches[0].clientY},t)})),e.addEventListener("touchend",(t=>{t.touches.length<1?r(a.position,t,!0):r({x:t.touches[0].clientX,y:t.touches[0].clientY},t,!1)})),e.addEventListener("touchmove",(t=>{h({x:t.touches[0].clientX,y:t.touches[0].clientY},t)})),document.addEventListener("keydown",(i=>{const{key:s,keyCode:n,code:a}=i;" "!==s&&32!==n&&"Space"!==a&&"Enter"!==s&&13!==n&&"NumpadEnter"!==a&&"Enter"!==a||(t.startAtKeyBoardEvent(),c({x:e.width/2,y:e.height/2},i))})),document.addEventListener("keyup",(t=>{const{key:i,keyCode:s,code:n}=t;" "!==i&&32!==s&&"Space"!==n&&"Enter"!==i&&13!==s&&"NumpadEnter"!==n&&"Enter"!==n||r({x:e.width/2,y:e.height/2},t,!1)}))})(le,he),ce.style.display="none",document.body.style.backgroundColor="rgba(28, 28, 30, 1)"};window.addEventListener("DOMContentLoaded",(()=>{ce.insertBefore(oe,ce.childNodes[0]),ue.add_loop_function(pe),(t=>{let e=!1;new se([ne]).then((()=>{const i=new p(se.get(ne));i.cutOut("theme-day",0,0,288,512),i.cutOut("theme-night",292,0,288,512),i.cutOut("platform",584,0,336,112),i.cutOut("pipe-red-top",0,646,52,320),i.cutOut("pipe-red-bottom",56,646,52,320),i.cutOut("pipe-green-bottom",168,646,52,320),i.cutOut("pipe-green-top",112,646,52,320),i.cutOut("score-board",4,516,232,123),i.cutOut("coin-dull-metal",224,906,44,44),i.cutOut("coin-dull-bronze",224,954,44,44),i.cutOut("coin-shine-silver",242,516,44,44),i.cutOut("coin-shine-gold",242,564,44,44),i.cutOut("number-sm-0",276,646,12,14),i.cutOut("number-sm-1",282,664,6,14),i.cutOut("number-sm-2",276,698,12,14),i.cutOut("number-sm-3",276,716,12,14),i.cutOut("number-sm-4",276,750,12,14),i.cutOut("number-sm-5",276,768,12,14),i.cutOut("number-sm-6",276,802,12,14),i.cutOut("number-sm-7",276,820,12,14),i.cutOut("number.sm-8",276,854,12,14),i.cutOut("number-sm-9",276,872,12,14),i.cutOut("number-md-0",274,612,14,20),i.cutOut("number-md-1",278,954,10,20),i.cutOut("number-md-2",274,978,14,20),i.cutOut("number-md-3",262,1002,14,20),i.cutOut("number-md-4",1004,0,14,20),i.cutOut("number-md-5",1004,24,14,20),i.cutOut("number-md-6",1010,52,14,20),i.cutOut("number-md-7",1010,84,14,20),i.cutOut("number-md-8",586,484,14,20),i.cutOut("number-md-9",622,412,14,20),i.cutOut("number-lg-0",992,120,24,36),i.cutOut("number-lg-1",272,910,16,36),i.cutOut("number-lg-2",584,320,24,36),i.cutOut("number-lg-3",612,320,24,36),i.cutOut("number-lg-4",640,320,24,36),i.cutOut("number-lg-5",668,320,24,36),i.cutOut("number-lg-6",584,368,24,36),i.cutOut("number-lg-7",612,368,24,36),i.cutOut("number-lg-8",640,368,24,36),i.cutOut("number-lg-9",668,368,24,36),i.cutOut("toast-new",224,1002,32,14),i.cutOut("btn-pause",242,612,26,28),i.cutOut("btn-share",584,284,80,28),i.cutOut("btn-play-icon",668,284,26,28),i.cutOut("btn-play",706,236,110,64),i.cutOut("btn-ranking",826,236,110,64),i.cutOut("btn-menu",924,52,80,28),i.cutOut("btn-ok",924,84,80,28),i.cutOut("btn-rate",926,2,70,44),i.cutOut("bird-yellow-up",6,982,34,24),i.cutOut("bird-yellow-mid",62,982,34,24),i.cutOut("bird-yellow-down",118,982,34,24),i.cutOut("bird-blue-up",174,982,34,24),i.cutOut("bird-blue-mid",230,658,34,24),i.cutOut("bird-blue-down",230,710,34,24),i.cutOut("bird-red-up",230,762,34,24),i.cutOut("bird-red-mid",230,814,34,24),i.cutOut("bird-red-down",230,866,34,24),i.cutOut("spark-sm",276,682,10,10),i.cutOut("spark-md",276,734,10,10),i.cutOut("spark-lg",276,786,10,10),i.cutOut("banner-game-ready",586,118,192,58),i.cutOut("banner-game-over",786,118,200,52),i.cutOut("banner-flappybird",702,182,178,52),i.cutOut("banner-instruction",584,182,114,98),i.cutOut("copyright",886,184,122,10),i.cutOut("icon-plus",992,168,10,10),i.cutOut("btn-mute",816,306,90,66),i.cutOut("btn-speaker",712,306,90,66),i.cutOut("btn-fps-enable",710,403,60,36),i.cutOut("btn-fps-disable",798,403,60,36),i.cutOut("btn-fps-locked",729,462,41,36),i.cutOut("btn-fps-unlocked",799,462,41,36);const s=()=>{e&&t(),e=!0};i.then(s),new u({hit:E,wing:T,swoosh:D,die:k,point:z},s)}))})((()=>{ge=!0,le.init(),me(),ue.start(),window.setTimeout(fe,1e3)}))})),window.addEventListener("resize",(()=>{ge&&me()}))}},t=>{t(t.s=794)}]);